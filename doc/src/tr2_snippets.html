<html>
<!-- © Copyright Beman Dawes 2012 -->
<!-- Distributed under the Boost Software License, Version 1.0. -->
<!-- See http://www.boost.org/LICENSE_1_0.txt -->
<head>
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Filesystem Proposal</title>
</head>

<body>

$id frontmatter=
  <table border="0">
    <tr>
      <td>Document number:&nbsp;&nbsp; </td>
      <td><span style="background-color: #FFFF99">D????=12-????</span></td>
    </tr>
    <tr>
      <td>Date:</td>
      <td>
      <!--webbot bot="Timestamp" S-Type="EDITED" S-Format="%Y-%m-%d" startspan -->2012-08-09<!--webbot bot="Timestamp" endspan i-checksum="12504" --></td>
    </tr>
    <tr>
      <td>Project:</td>
      <td>Programming Language C++</td>
    </tr>
    <tr>
      <td valign="top">Reply-to:</td>
      <td>Beman Dawes &lt;bdawes at acm dot org&gt;</td>
    </tr>
  </table>


<p><span style="font-style: italic; background-color: #FFFF99">Material  high-lighted in yellow 
in this draft is known to be incomplete, incorrect, or 
otherwise require further refinement.</span></p>


<h1><span style="background-color: #FFFF99">Draft</span><br>
Filesystem Library Proposal (Revision 3)</h1>


<p>This paper proposes a filesystem library component suitable for a <i>C++ 
Standard Library Technical Specification</i> or for the <i>C++ Standard Library</i>. 
The proposed library is based on the Boost Filesystem Library (<a href="http://www.boost.org/libs/filesystem">www.boost.org/libs/filesystem</a>), 
version 3. Proposed wording is provided. A
<a href="#TODO">TODO</a> list identifies remaining work to be done.</p>


<p>The proposal is a pure addition; no existing headers are modified. No 
compiler support is required. C++11 features are used where appropriate. The 
entire library is in a namespace within namespace <code>std</code>.</p>


<h2>Library background</h2>


<p>The Boost version of the library has been in widespread use for ten years. 
The Dinkumware version of the library, based on <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/n1975.html">
N1975</a> (equivalent to version 2 of the Boost library), ships with Microsoft 
Visual C++ 2012.</p>


<p>The motivation and scope for a filesystem library were described in <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/n1975.html">
N1975</a>, and are not repeated here. A minor scope reduction is that an 
addition to the current C++ runtime library is no longer needed.</p>


<p>Boost Filesystem Version 3  introduced a single path type that interoperates well with both <code>
basic_string</code> and user defined string types.</p>


<h2>Revision history</h2>


<p><span style="background-color: #FFFF99">D????=12-???? </span>, Filesystem 
Library Proposal (Revision 3). Changes include:</p>


<ul>
  <li>Add path::operator+= and concat functions to tack on things like suffixes 
  or numbers. Suggested by Ed Smith-Rowland and others.</li>
    <li>Add section tags and section numbers, per LWG 
    discussion in Kona.</li>
  <li>Minimize use of trademarked names. Enclose uses in green highlighted boxes 
  to facilitate discussion.</li>
  <li>Introduce a definition for &quot;operating system dependent&quot;, and then use it 
  to replace &quot;implementation defined behavior&quot; wherever the operating 
  system's rules determine behavior.</li>
  <li>Replace uses of&nbsp; const string return types with non-const string 
  return types, per LWG discussion in Kona.</li>
  <li>Remove permission for implementations to return const string&amp; in certain 
  cases, per LWG discussion in Kona.</li>
  <li>Remove path inserter and extractor dependency on Boost quoted manip (Issue 
  7).</li>
  <li>Replace use of <code>time_t</code> with <code>file_time_type</code>, a 
  typedef for <code>std::chrono::system_clock::time_point</code>, per LWG 
  discussion in Kona.</li>
  <li><code>recursive_directory_iterator</code> specifications are now given in 
  terms of behavior only. Private &quot;for exposition only&quot; members have been 
  removed.</li>
  <li dir="ltr">
  <p dir="ltr"><code>recursive_directory_iterator</code> functions <code>
  no_push_pending()</code> and <code>no_push()</code> have been renamed <code>
  recursion_pending()</code> and <code>disable_recursion_pending()</code>. 
  Option constant name <code>recurse</code> has been renamed <code>
  follow_directory_symlinks</code>.&nbsp; These are responses to a request from 
  Ed Smith-Rowland to improve clarity by reducing negative logic.</li>
  <li>
  <p dir="ltr">A <code>recursive_directory_iterator</code> option <code>
  skip_permission_denied</code> has been added to skip directories with 
  permission denied, responding to several user requests.</li>
  <li>
  <p><code>symlink_option</code> has been renamed <code>
  directory_options</code>, since it has become more general and now covers both
  <code>follow_directory_symlinks</code> and <code>skip_permission_denied</code> 
  options.&nbsp;</li>
  <li>
  <p>Missing semantics provided for <code>copy_directory</code>. </li>
  <li>Add C++11 features to both the proposal and the Boost implementation and 
  test suite:<ul>
  <li>R-value reference move semantics.</li>
  <li><code>noexcept</code>.</li>
  <li><code>constexpr</code>.</li>
  <li>Range-based for statement support.</li>
  <li>New character types.</li>
  <li>Replace replace explicit codecvt manipulation with a reference to <code>&lt;cuchar&gt;</code> 
  conversion facilities.</li>
</ul>


  </li>
</ul>


<p><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3365.html">N3365=12-0055</a>, Filesystem Library Proposal (Revision 
2). Changes 
include:</p>


<ul>
  <li>Namespaces changed to <code>std::tbd::filesystem</code> per 
  <a href="#Issues-List">issue 
  1</a> discussion in Kona.</li>
  <li>Removed references to Boost within the proposed wording.</li>
  <li>Minor fixes to the proposed wording.</li>
  <li>Added Issue 7: How should class path inserter and extractor be specified?</li>
  <li>Marked up all issues to reflect Kona LWG discussions.</li>
</ul>


<p><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3335.html">
N3335=12-0025</a>, Filesystem Library for C++11/TR2 (Revision 1). Changes 
include:</p>


  <ul>
    <li>Regenerated the proposed wording from the Boost Filesystem library 
    reference documentation, using an automated process. This process reduces 
    the likelihood of inadvertent discrepancies between descriptions.</li>
    <li>An <a href="#Issues-List">Issues list</a> was added, seeded with issues 
    raised by the LWG review of N3239 at the Bloomington meeting, and private 
    communications from LWG members.</li>
    <li>Namespace changed to <code>files</code> as an experiment. Made this 
    issue number 1 so the LWG can pass judgment.</li>
    <li>New functions were added, suggested by David Svoboda, to generate 
    canonical paths and manage permissions.</li>
    <li>More C++11 functionality was applied. This process is still incomplete, 
    however.</li>
    <li>Added proposed changes to header &lt;fstream&gt;. The previous paper had 
    inadvertently supplied the wrong wording.</li>
    <li>Continued the general cleanup of wording.</li>
</ul>


<p><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2011/n3239.html">
N3239 = 11-0009</a>, Filesystem Library Update for TR2 (Preliminary), reflected 
changes made to the Boost library version 3 since the previously accepted 
committee paper:</p>


  <ul>
    <li>A single class <code>path</code> handles all aspects of 
    internationalization, replacing the previous template and its <code>path</code> 
    and <code>wpath</code> instantiations. Character types <code>char</code>,
    <code>wchar_t</code>, <code>char16_t</code>, and <code>char32_t</code> are 
    supported. This is a major simplification of the path abstraction, 
    particularly for functions that take path arguments. This change was based 
    on a suggestion by Peter Dimov.</li>
    <li>Several operational functions have been added, including much better 
    symlink support, the ability to resize a file, and the ability to generate a 
    unique path.</li>
    <li>Support for error reporting via <code>error_code</code> is now uniform 
    throughout the operations functions.</li>
    <li>Several functions have been renamed, based on feedback from users.</li>
  </ul>


<p><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/n1975.html">
N1975 = 06-0045</a>, Filesystem Library Proposal for TR2 (Revision 3), was 
adopted by the committee in April, 2006, at the Berlin meeting. Shortly 
afterward the Library Working Group set aside work on TR2 to concentrate on 
C++0x.</p>


  <h2><a name="TODO">TODO</a></h2>
  <ul>
    <li>Ion Todirel suggests &quot;Would be nice if path::append was variadic, to 
    improve usability&quot;.</li>
    <li>Ion Todirel: Would be nice to have a make_relative. Need to review 
    similar suggestions.</li>
    <li>Dinkumware/Microsoft report slightly different results for Decomposition 
    table. Rerun table. Check discrepancies.</li>
    <li>Review Nick Stoughton's email for suggestions, action items.</li>
  </ul>
  
  $endid

$id wording_prefix=
<h1>Proposed Wording</h1>

<!-- generate-section-numbers=true -->

<p><span style="font-style: italic; background-color: rgb(224, 224, 224);">
Gray-shaded italic text is commentary on the proposal. It is not to be added to 
the working paper.</span></p>
<h1>Filesystem Library [filesystem]</h1>

<p>This clause describes components that perform operations on file systems and 
their components, such as paths, regular files, and directories.</p>

<p>ISO/IEC 9945 contains provisions which, through reference in this 
text, constitute provisions of this clause. At the time of 
publication, the editions indicated were valid. All standards are subject to 
revision, and parties to agreements based on this clause are 
encouraged to investigate the possibility of applying the most recent editions 
of the standard indicated below. Members of IEC and ISO maintain registers of 
currently valid International Standards.</p>
<ul>
  <li>ISO/IEC 9945:2003, <i>Portable Operating System Interface (POSIX</i>®<i>), 
  part 1 (Base Definitions) and part 2 (System Interfaces)</i>, both as 
  corrected by their respective 2004 Correction 1 documents.<p><i>
  <span style="background-color: #E0E0E0">ISO/</span><span style="background-color: #E0E0E0">IEC</span><span style="background-color: #E0E0E0"> 9945:2003 is also IEEE&nbsp;Std&nbsp;1003.1-2001, and The Open Group Base 
  Specifications, Issue 6, and is also known as The Single Unix®</span></i><font face="Times New Roman"><i><b><span style="background-color: #E0E0E0">
  </span>
  </b></i><span style="font-style: italic; background-color: #E0E0E0">Specification, Version 3. It is available from each of those 
  organizations, and may be read online or downloaded from
  <a href="http://www.unix.org/single_unix_specification/">
  www.unix.org/single_unix_specification/</a></span></font></li>
</ul>

<p>This clause may mention commercially 
available operating systems for purposes of exposition. This information is given for the convenience of 
users of this document and does not constitute an endorsement by ISO or IEC of 
these products.<p>$endid

$id wording_suffix= </p>
<p><span style="font-style: italic; background-color: #E0E0E0">End of Proposed 
wording.</span></p>
<hr>
<p>$endid

$id backmatter=
$endid </p>
 
</body>

</html>